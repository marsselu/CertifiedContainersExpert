- image: cgr.dev/chainguard/nginx:latest
        name: nginx-task-day4
        ports: # Expondo a porta 80 do container para o host e probes funcionarem corretamente  
          - containerPort: 80
        command: ["nginx", "-g", "daemon off;"]
        resources:
          limits:
            cpu: "0.5"
            memory: "128Mi"
          requests:
            cpu: "0.25"
            memory: 64Mi
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        startupProbe:
          tcpSocket:
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5













- image: cgr.dev/chainguard/nginx:latest
        name: nginx-task-day4
        ports:
          - containerPort: 80
        resources:
          limits:
            cpu: "0.5"
            memory: "128Mi"
          requests:
            cpu: "0.25"
            memory: 64Mi
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        startupProbe:
          tcpSocket:
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5

      - image: cgr.dev/chainguard/cosign:latest
        name: cosign-task-day4
        command: ["tail", "-f", "/dev/null"]
        resources:
          limits:
            cpu: "0.5"
            memory: "128Mi"
          requests:
            cpu: "0.25"
            memory: 64Mi
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - "cosign version > /dev/null 2>&1"
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - "cosign help > /dev/null 2>&1"
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
        startupProbe:
          exec:
            command:
            - sh
            - -c
            - "which cosign"
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          failureThreshold: 2
          timeoutSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: task-day4-service
  labels:
    app: task-day4-deployment
spec:
  selector:
    app: task-day4-deployment
  ports:
    - name: http
      port: 80          # Porta interna do cluster
      targetPort: 80    # Porta do container nginx
      nodePort: 30080   # Porta fixa no host (localhost:30080)
  type: NodePort        # Expondo externamente (acess√≠vel via localhost)